<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/admin-layout}"
      lang="fr">
<body>

<div layout:fragment="content">
  <h1 class="text-3xl font-bold text-gray-900 mb-8">Commandes</h1>

  <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">

    <form th:action="@{/admin/commands}" method="get" id="filterForm" class="p-6 border-b border-gray-50 flex flex-col md:flex-row gap-4 justify-between items-center">

      <div class="relative w-full md:w-2/3">
        <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">
          <i class="fa-solid fa-magnifying-glass"></i>
        </span>
        <input type="text"
               name="search"
               th:value="${param.search}"
               placeholder="Rechercher par ID, client..."
               class="block w-full pl-10 pr-3 py-2 border border-gray-200 rounded-xl bg-gray-50 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500 transition">
      </div>

      <div class="w-full md:w-auto">
        <select name="status"
                onchange="document.getElementById('filterForm').submit()"
                class="block w-full pl-3 pr-10 py-2 text-sm border-gray-200 bg-gray-50 rounded-xl focus:outline-none focus:ring-2 focus:ring-cyan-500">
          <option value="">Tous les status</option>
          <option th:each="s : ${status}"
                  th:value="${s}"
                  th:text="${s.label}"
                  th:selected="${param.status != null and param.status[0] == s}">
          </option>
        </select>
      </div>
    </form>

    <div class="overflow-x-auto">
      <table class="w-full text-left">
        <thead>
        <tr class="bg-gray-50 text-gray-400 text-xs uppercase tracking-wider text-center">
          <th class="px-6 py-4 font-semibold">Id commande</th>
          <th class="px-6 py-4 font-semibold">Client</th>
          <th class="px-6 py-4 font-semibold">Date</th>
          <th class="px-6 py-4 font-semibold">Total</th>
          <th class="px-6 py-4 font-semibold">Status</th>
          <th class="px-6 py-4 font-semibold text-right">Actions</th>
        </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
        <tr th:each="commande : ${allCommands}" class="hover:bg-gray-50 transition">
          <td class="px-6 py-4 text-center">
            <span class="font-medium text-gray-900" th:text="${'#' + commande.id}">#1234</span>
          </td>
          <td class="px-6 py-4">
            <div class="flex flex-col">
                <span class="text-sm font-semibold text-gray-800"
                      th:text="${commande.user.firstname + ' ' + commande.user.lastname}">Nom Client</span>
              <span class="text-xs text-gray-500" th:text="${commande.user.email}">email@mail.com</span>
            </div>
          </td>
          <td class="px-6 py-4 text-sm text-gray-600"
              th:text="${#temporals.format(commande.createdAt, 'dd/MM/yyyy HH:mm')}">
            24/05/2024
          </td>
          <td class="px-6 py-4 font-bold text-gray-900"
              th:text="${#numbers.formatDecimal(commande.total, 1, 'POINT', 2, 'COMMA') + '€'}">
            0,00€
          </td>
          <td class="px-6 py-4 text-center">
            <span class="px-3 py-1 rounded-full text-xs font-semibold"
                  th:style="'background-color: #' + ${colors.get(commande.status)} + '; color: rgba(0,0,0,0.7);'"
                  th:text="${commande.status.label}">
              Status
            </span>
          </td>
          <td class="px-6 py-4 text-right">
            <div x-data="{ open: false }" class="relative inline-block text-left">

              <button @click="open = !open"
                      @click.away="open = false"
                      class="flex items-center justify-center w-10 h-10 hover:bg-gray-100 text-gray-500 rounded-lg border border-gray-200 transition-colors focus:outline-none bg-white">
                <i class="fa-solid fa-ellipsis-vertical"></i>
              </button>

              <div x-show="open"
                   x-transition:enter="transition ease-out duration-100"
                   x-transition:enter-start="transform opacity-0 scale-95"
                   x-transition:enter-end="transform opacity-100 scale-100"
                   x-transition:leave="transition ease-in duration-75"
                   x-transition:leave-start="transform opacity-100 scale-100"
                   x-transition:leave-end="transform opacity-0 scale-95"
                   class="absolute right-0 z-50 mt-2 w-48 origin-top-right rounded-xl bg-white shadow-lg ring-1 ring-black ring-opacity-5 border border-gray-100 focus:outline-none"
                   style="display: none;">

                <div class="py-1 px-1">
                  <a th:href="@{/admin/commands/{id}(id=${commande.id})}"
                     class="flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-cyan-50 hover:text-cyan-600 rounded-lg transition">
                    <i class="fa-solid fa-eye w-4 text-center"></i>
                    Voir les détails
                  </a>

                  <a th:href="@{/admin/commands/edit/{id}(id=${commande.id})}"
                     class="flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-amber-50 hover:text-amber-600 rounded-lg transition">
                    <i class="fa-solid fa-pen-to-square w-4 text-center"></i>
                    Modifier le statut
                  </a>

                  <hr class="my-1 border-gray-50">

                  <button class="w-full flex items-center gap-3 px-4 py-2 text-sm text-red-600 hover:bg-red-50 rounded-lg transition text-left">
                    <i class="fa-solid fa-trash w-4 text-center"></i>
                    Annuler la commande
                  </button>
                </div>
              </div>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <nav aria-label="Page navigation" class="flex flex-col sm:flex-row items-center justify-center my-12"
         th:with="maxVisible=5,
              offset=${currentPage > 2 ? (currentPage < totalPages - 2 ? currentPage - 2 : (totalPages > maxVisible ? totalPages - maxVisible : 0)) : 0},
              lastIdx=${totalPages > 0 ? (totalPages > (offset + maxVisible) ? offset + maxVisible - 1 : totalPages - 1) : 0}">

      <ul class="flex -space-x-px text-sm" th:if="${totalPages > 1}">

        <li th:if="${currentPage > 0}">
          <a th:href="@{/admin/commands(page=0, search=${param.search}, status=${param.status})}"
             class="flex items-center justify-center w-10 h-10 border border-gray-300 rounded-s-lg bg-white hover:bg-gray-100 text-gray-500">
            <i class="fa-solid fa-angles-left text-xs"></i>
          </a>
        </li>

        <li th:each="i : ${#numbers.sequence(offset, lastIdx)}">
          <a th:href="@{/admin/commands(page=${i}, search=${param.search}, status=${param.status})}"
             th:text="${i + 1}"
             th:classappend="${currentPage == i} ? 'z-10 bg-cyan-600 text-white border-cyan-600' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'"
             class="flex items-center justify-center w-10 h-10 border transition-colors font-medium">
          </a>
        </li>

        <li th:if="${currentPage < totalPages - 1}">
          <a th:href="@{/admin/commands(page=${totalPages - 1}, search=${param.search}, status=${param.status})}"
             class="flex items-center justify-center w-10 h-10 border border-gray-300 rounded-e-lg bg-white hover:bg-gray-100 text-gray-500">
            <i class="fa-solid fa-angles-right text-xs"></i>
          </a>
        </li>

      </ul>
    </nav>
  </div>
</div>
</body>
<th:block layout:fragment="scripts">
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</th:block>
</html>