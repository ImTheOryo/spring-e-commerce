<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/admin-layout}"
      lang="fr">
<body>

<div layout:fragment="content">
  <div class="flex justify-between items-center mb-8">
    <h1 class="text-3xl font-bold text-gray-900">Catalogue Produits</h1>
    <a th:href="@{/admin/products/create}"
       class="bg-cyan-600 hover:bg-cyan-700 text-white px-5 py-2.5 rounded-xl transition flex items-center gap-2 shadow-sm">
      <i class="fa-solid fa-plus text-sm"></i>
      Ajouter un produit
    </a>
  </div>

  <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">

    <form th:action="@{/admin/products}" method="get" id="filterForm" class="p-6 border-b border-gray-50 flex flex-col md:flex-row gap-4 justify-between items-center">
      <div class="relative w-full md:w-2/3">
        <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">
          <i class="fa-solid fa-magnifying-glass"></i>
        </span>
        <input type="text" name="search" th:value="${param.search}"
               placeholder="Rechercher par nom, marque, modèle..."
               class="block w-full pl-10 pr-3 py-2 border border-gray-200 rounded-xl bg-gray-50 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500 transition">
      </div>

      <div class="w-full md:w-auto">
        <select name="category" onchange="document.getElementById('filterForm').submit()"
                class="block w-full pl-3 pr-10 py-2 text-sm border-gray-200 bg-gray-50 rounded-xl focus:outline-none focus:ring-2 focus:ring-cyan-500">
          <option value="">Toutes les catégories</option>
          <option th:each="cat : ${categories}"
                  th:value="${cat.id}"
                  th:text="${cat.name}"
                  th:selected="${param.category != null and param.category[0] == cat.id.toString()}">
          </option>
        </select>
      </div>
    </form>

    <div class="overflow-x-auto">
      <table class="w-full text-center">
        <thead>
        <tr class="bg-gray-50 text-gray-400 text-xs uppercase tracking-wider text-center">
          <th class="px-6 py-4 font-semibold">Produit</th>
          <th class="px-6 py-4 font-semibold">Catégorie</th>
          <th class="px-6 py-4 font-semibold">Stock</th>
          <th class="px-6 py-4 font-semibold">Prix Unit.</th>
          <th class="px-6 py-4 font-semibold">Statut</th>
          <th class="px-6 py-4 font-semibold text-right">Actions</th>
        </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
        <tr th:each="product : ${allProducts}" class="text-center hover:bg-gray-50/50 transition">
          <td class="px-6 py-4">
            <div class="flex items-center gap-4">
              <img th:src="${product.urlPhoto}" class="w-12 h-12 object-contain rounded-lg bg-gray-50 border border-gray-100" alt="Img">
              <div class="flex flex-col">
                <span class="text-sm font-bold text-gray-900" th:text="${product.brand + ' ' + product.model}">Marque Modèle</span>
                <span class="text-xs text-gray-500 truncate max-w-[200px]" th:text="${product.name}">Nom complet du produit</span>
              </div>
            </div>
          </td>
          <td class="px-6 py-4">
            <span class="text-sm text-gray-600" th:text="${product.category.name}">Catégorie</span>
          </td>
          <td class="px-6 py-4">
            <div class="flex flex-col gap-1">
              <span class="text-sm font-medium" th:text="${product.stock + ' unités'}">0</span>
              <span th:if="${!product.isInStock}" class="text-[10px] text-red-500 font-bold uppercase">Rupture</span>
            </div>
          </td>
          <td class="px-6 py-4">
            <div class="flex flex-col">
              <span class="font-bold text-gray-900" th:text="${#numbers.formatDecimal(product.price, 1, 'NONE', 2, 'COMMA') + '€'}">0,00€</span>
              <span th:if="${product.isPromotion}" class="text-xs text-orange-600 font-semibold"
                    th:text="${'-' + product.promotionPourcent + '% promo'}">
                -10%
              </span>
            </div>
          </td>
          <td class="px-6 py-4">
            <span th:if="${product.isAvailable}" class="inline-flex items-center gap-1.5 py-1 px-2.5 rounded-full text-xs font-medium bg-green-100 text-green-700">
              <span class="w-1.5 h-1.5 rounded-full bg-green-600"></span> Disponible
            </span>
            <span th:unless="${product.isAvailable}" class="inline-flex items-center gap-1.5 py-1 px-2.5 rounded-full text-xs font-medium bg-red-100 text-gray-600">
              <span class="w-1.5 h-1.5 rounded-full bg-red-400"></span> Non disponible
            </span>
          </td>
          <td class="px-6 py-4 text-right">
            <div class="flex justify-end gap-3">
              <a th:href="@{/admin/products/edit/{id}(id=${product.id})}" class="p-2 text-gray-400 hover:text-cyan-600 transition">
                <i class="fa-solid fa-pen-to-square"></i>
              </a>
              <button class="p-2 text-gray-400 hover:text-red-500 transition">
                <i class="fa-solid fa-trash"></i>
              </button>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <nav aria-label="Page navigation" class="flex flex-col sm:flex-row items-center justify-center my-10"
         th:with="maxVisible=5,
              offset=${currentPage > 2 ? (currentPage < totalPages - 2 ? currentPage - 2 : (totalPages > maxVisible ? totalPages - maxVisible : 0)) : 0},
              lastIdx=${totalPages > 0 ? (totalPages > (offset + maxVisible) ? offset + maxVisible - 1 : totalPages - 1) : 0}">
      <ul class="flex -space-x-px text-sm" th:if="${totalPages > 1}">
        <li th:if="${currentPage > 0}">
          <a th:href="@{/admin/products(page=0, search=${param.search}, category=${param.category})}"
             class="flex items-center justify-center w-10 h-10 border border-gray-300 rounded-s-xl bg-white hover:bg-gray-100 text-gray-500">
            <i class="fa-solid fa-angles-left"></i>
          </a>
        </li>
        <li th:each="i : ${#numbers.sequence(offset, lastIdx)}">
          <a th:href="@{/admin/products(page=${i}, search=${param.search}, category=${param.category})}"
             th:text="${i + 1}"
             th:classappend="${currentPage == i} ? 'z-10 bg-cyan-600 text-white border-cyan-600' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'"
             class="flex items-center justify-center w-10 h-10 border transition-colors font-semibold">
          </a>
        </li>
        <li th:if="${currentPage < totalPages - 1}">
          <a th:href="@{/admin/products(page=${totalPages - 1}, search=${param.search}, category=${param.category})}"
             class="flex items-center justify-center w-10 h-10 border border-gray-300 rounded-e-xl bg-white hover:bg-gray-100 text-gray-500">
            <i class="fa-solid fa-angles-right"></i>
          </a>
        </li>
      </ul>
    </nav>
  </div>
</div>

</body>
</html>